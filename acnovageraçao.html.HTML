<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema AC Nova Gera√ß√£o - Definitivo</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root { --azul-escuro: #002244; --dourado: #cfb53b; --fundo: #f4f4f9; --texto: #333; }
        * { box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: var(--fundo); margin: 0; padding: 0; color: var(--texto); }
        
        .header { background-color: var(--azul-escuro); color: var(--dourado); padding: 15px 20px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 4px 6px rgba(0,0,0,0.2); }
        .logo-area { display: flex; align-items: center; gap: 15px; }
        .escudo-img { height: 60px; width: 60px; object-fit: contain; border-radius: 50%; }
        .header h1 { margin: 0; font-size: 24px; text-transform: uppercase; letter-spacing: 1px; }
        
        .nav-bar { background-color: #fff; display: flex; justify-content: center; gap: 8px; padding: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; flex-wrap: wrap; }
        .tab-btn { background-color: #eee; border: none; padding: 10px 15px; font-size: 15px; font-weight: bold; color: var(--azul-escuro); cursor: pointer; border-radius: 5px; transition: 0.3s; display: flex; align-items: center; gap: 8px; }
        .tab-btn:hover { background-color: #ddd; }
        .tab-btn.active { background-color: var(--dourado); color: var(--azul-escuro); }
        .tab-btn.highlight { background-color: #e6f7ff; border: 1px solid #007bff; }
        .tab-btn.settings { background-color: #444; color: white; }

        .container { max-width: 1100px; margin: auto; padding: 0 20px 40px 20px; overflow-x: auto; }
        .tab-content { display: none; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .dashboard { display: flex; gap: 15px; margin-bottom: 25px; flex-wrap: wrap; }
        .card { flex: 1; min-width: 200px; padding: 20px; border-radius: 8px; text-align: center; color: white; font-weight: bold; }
        .card h3 { margin: 0 0 10px 0; font-size: 16px; text-transform: uppercase; }
        .card .valor { font-size: 26px; }
        .bg-receita { background: linear-gradient(45deg, #28a745, #218838); }
        .bg-despesa { background: linear-gradient(45deg, #dc3545, #c82333); }
        .bg-saldo { background: linear-gradient(45deg, var(--azul-escuro), #004080); }

        .painel-alertas { display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 25px; }
        .niver-box, .ranking-box { flex: 1; min-width: 300px; padding: 15px 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .niver-box { background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%); border-left: 5px solid #00bcd4; display: none; }
        .ranking-box { background: linear-gradient(135deg, #fff3cd 0%, #ffeeba 100%); border-left: 5px solid #ffc107; }
        .alerta-title { font-size: 18px; font-weight: bold; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .niver-item { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.8); padding: 8px 12px; border-radius: 4px; margin-bottom: 8px; font-size: 14px; font-weight: bold; color: #333; }
        .niver-hoje { background: #ff4b82; color: white; border: none; box-shadow: 0 2px 5px rgba(255,75,130,0.4); }

        .form-row { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; align-items: flex-end; background: #f9f9f9; padding: 15px; border-radius: 8px; border-left: 4px solid var(--dourado); }
        .form-group { display: flex; flex-direction: column; flex: 1; min-width: 130px; }
        label { font-size: 13px; font-weight: bold; margin-bottom: 5px; color: #555; }
        input, select, textarea { padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; font-family: inherit; }
        button.btn-add { background-color: var(--azul-escuro); color: var(--dourado); padding: 10px 20px; font-weight: bold; border: none; border-radius: 4px; cursor: pointer; height: 40px; transition: 0.2s; }
        button.btn-add:hover { background-color: #00152b; }

        .table-responsive { width: 100%; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; min-width: 600px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; vertical-align: middle; }
        th { background-color: #f1f1f1; color: var(--azul-escuro); font-weight: bold; }
        tr:hover { background-color: #f9f9f9; }

        .action-btns { display: flex; gap: 4px; flex-wrap: wrap; }
        .btn-sm { padding: 6px 8px; border: none; border-radius: 4px; font-size: 12px; font-weight: bold; cursor: pointer; color: white; display: inline-flex; align-items: center; gap: 5px; text-decoration: none;}
        .btn-zap { background-color: #25D366; } .btn-pay { background-color: #28a745; } .btn-del { background-color: #dc3545; }
        .btn-gol { background-color: #000; } .btn-amarelo { background-color: #ffc107; color: #000; } .btn-vermelho { background-color: #dc3545; }
        .btn-perfil { background-color: #007bff; } .btn-azul { background-color: #17a2b8; }
        
        .badge { padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; color: white; }
        .badge-ok { background-color: #28a745; } .badge-pendente { background-color: #ffc107; color: #333; } .badge-atrasado { background-color: #dc3545; }
        .cat-tag { background-color: var(--azul-escuro); color: var(--dourado); padding: 3px 6px; border-radius: 4px; font-size: 11px; font-weight: bold; }
        
        .atleta-info { display: flex; align-items: center; gap: 10px; }
        .avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid var(--dourado); background: #eee; }

        /* MODAL */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); align-items: center; justify-content: center; padding: 15px; }
        .modal-content { background-color: #fff; padding: 20px; border-radius: 12px; width: 100%; max-width: 500px; text-align: center; position: relative; box-shadow: 0 5px 15px rgba(0,0,0,0.5); max-height: 90vh; overflow-y: auto; }
        .close-modal { position: absolute; right: 15px; top: 10px; font-size: 24px; font-weight: bold; color: #aaa; cursor: pointer; }
        .perfil-header { border-bottom: 2px solid var(--dourado); padding-bottom: 15px; margin-bottom: 15px; }
        .perfil-foto { width: 100px; height: 100px; border-radius: 50%; border: 4px solid var(--azul-escuro); object-fit: cover; margin: auto; display: block; background: #eee; }
        .perfil-stats { display: flex; justify-content: space-around; background: #f4f4f9; padding: 10px; border-radius: 8px; margin-bottom: 15px; font-weight: bold; }
        .radar-container { width: 100%; max-width: 320px; margin: auto; margin-bottom: 20px; }
        
        .historico-box { background: #f9f9f9; border-radius: 8px; padding: 15px; text-align: left; margin-bottom: 20px; border: 1px solid #eee; }
        .historico-table { width: 100%; font-size: 12px; text-align: center; border-collapse: collapse; }
        .historico-table th { background: var(--azul-escuro); color: white; padding: 5px; border-radius: 4px; }
        .historico-table td { padding: 5px; border-bottom: 1px solid #ddd; font-weight: bold; }

        /* CONFIGURA√á√ÉO DA IMAGEM OFICIAL DO BOLETIM */
        #relatorio-print-container { display: none; position: fixed; top: -10000px; left: 0; width: 800px; background: white; z-index: -1; }
        #relatorio-print { background: #fff; padding: 40px; color: #000; border: 12px solid var(--azul-escuro); border-radius: 15px; font-family: Arial, sans-serif; }
        .pdf-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 4px solid var(--dourado); padding-bottom: 20px; margin-bottom: 20px; }
        .pdf-title { text-align: center; flex: 1; }
        .pdf-title h1 { margin: 0; color: var(--azul-escuro); font-size: 32px; text-transform: uppercase; }
        .pdf-title h3 { margin: 5px 0 0 0; color: #555; }
        .pdf-body { display: flex; gap: 20px; margin-bottom: 20px; align-items: center; }
        .pdf-radar { flex: 1; text-align: center; display: flex; justify-content: center; align-items: center; }
        .pdf-info { flex: 1; font-size: 18px; line-height: 1.8; background: #f4f4f9; padding: 20px; border-radius: 10px; }
        .pdf-feedback { background: #e6f7ff; padding: 20px; border-left: 6px solid var(--azul-escuro); font-style: italic; font-size: 18px; margin-top: 20px; margin-bottom: 20px; border-radius: 0 10px 10px 0; }
        .circulo-pdf { width: 70px; height: 70px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 24px; }
        .circulo-clube { background: var(--azul-escuro); color: var(--dourado); border: 2px solid var(--dourado); }
        .circulo-atleta { background: var(--dourado); color: var(--azul-escuro); border: 2px solid var(--azul-escuro); font-size: 30px;}
    </style>
</head>
<body>

    <div class="header">
        <div class="logo-area">
            <div class="circulo-pdf circulo-clube" style="width: 50px; height: 50px; font-size: 18px;" id="topo_letra">AC</div>
            <img id="escudo-topo" src="" class="escudo-img" style="display:none;">
            <div>
                <h1>AC Nova Gera√ß√£o</h1>
                <small style="color: #ccc;">Gest√£o Padr√£o Ouro</small>
            </div>
        </div>
    </div>

    <div class="nav-bar">
        <button class="tab-btn active" onclick="openTab('mensalidades')"><i class="fa-solid fa-file-invoice"></i> Mensalidades</button>
        <button class="tab-btn" onclick="openTab('elenco')"><i class="fa-solid fa-users"></i> Elenco</button>
        <button class="tab-btn highlight" onclick="openTab('avaliacao')"><i class="fa-solid fa-image"></i> Card Boletim</button>
        <button class="tab-btn" onclick="openTab('agenda')"><i class="fa-regular fa-futbol"></i> Jogos & Taxas</button>
        <button class="tab-btn" onclick="openTab('uniformes')"><i class="fa-solid fa-shirt"></i> Uniformes</button>
        <button class="tab-btn" onclick="openTab('despesas')"><i class="fa-solid fa-wallet"></i> Caixa</button>
        <button class="tab-btn settings" onclick="openTab('configuracoes')"><i class="fa-solid fa-gear"></i> Config / Backup</button>
    </div>

    <div class="container">
        
        <div id="main-dash">
            <div class="painel-alertas">
                <div id="box-aniversarios" class="niver-box">
                    <div class="alerta-title" style="color: #006064;"><i class="fa-solid fa-cake-candles" style="color: #ff4b82;"></i> Aniversariantes do M√™s</div>
                    <div id="lista-niver"></div>
                </div>
                <div class="ranking-box">
                    <div class="alerta-title" style="color: #856404;"><i class="fa-solid fa-trophy" style="color: #d39e00;"></i> Top 3 Artilheiros</div>
                    <div id="lista-artilheiros"></div>
                </div>
            </div>

            <div class="dashboard">
                <div class="card bg-receita"><h3>Arrecadado</h3><div class="valor" id="dash-receita">R$ 0,00</div></div>
                <div class="card bg-despesa"><h3>Sa√≠das</h3><div class="valor" id="dash-despesa">R$ 0,00</div></div>
                <div class="card bg-saldo"><h3>Saldo em Caixa</h3><div class="valor" id="dash-saldo">R$ 0,00</div></div>
            </div>
        </div>

        <div id="mensalidades" class="tab-content active">
            <h2>Controle de Mensalidades</h2>
            <div class="form-row">
                <div class="form-group" style="flex: 2;"><label>Atleta/Respons√°vel</label><input type="text" id="m_nome"></div>
                <div class="form-group"><label>WhatsApp</label><input type="text" id="m_tel" placeholder="Ex: 82999999999"></div>
                <div class="form-group"><label>Vencimento</label><select id="m_venc"><option value="05">Dia 05</option><option value="10">Dia 10</option><option value="15">Dia 15</option></select></div>
                <button class="btn-add" onclick="addMensalidade()">Adicionar</button>
            </div>
            <div class="table-responsive">
                <table><thead><tr><th>Nome</th><th>Venc.</th><th>Status</th><th>Cobran√ßa Autom√°tica / A√ß√µes</th></tr></thead><tbody id="tb-mensalidades"></tbody></table>
            </div>
        </div>

        <div id="elenco" class="tab-content">
            <h2>Gest√£o do Elenco</h2>
            <div class="form-row">
                <div class="form-group" style="flex: 2;"><label>Nome do Atleta</label><input type="text" id="e_nome"></div>
                <div class="form-group" style="flex: 2;"><label>Foto (Link URL Opcional)</label><input type="url" id="e_foto" placeholder="Link da foto ou vazio"></div>
                <div class="form-group"><label>Cat.</label><select id="e_cat"><option>Sub-07</option><option>Sub-09</option><option>Sub-11</option><option>Sub-13</option><option>Sub-15</option></select></div>
                <div class="form-group"><label>Nasc.</label><input type="date" id="e_nasc"></div>
                <button class="btn-add" onclick="addJogador()">Matricular</button>
            </div>
            <div class="table-responsive">
                <table><thead><tr><th>Jogador (Nome e Nasc.)</th><th>Cat.</th><th>Estat√≠sticas de Jogo</th><th>Perfil & Evolu√ß√£o</th></tr></thead><tbody id="tb-elenco"></tbody></table>
            </div>
        </div>

        <div id="avaliacao" class="tab-content">
            <h2>Boletim em Formato de Imagem (Card Oficial)</h2>
            <p>Avalie o atleta e baixe a imagem para enviar direto no WhatsApp dos pais!</p>
            <div class="form-row" style="background: #eef2f5;">
                <div class="form-group" style="flex: 2;"><label>Selecione o Atleta</label><select id="av_atleta" onchange="carregarNotas()"><option value="">-- Escolha --</option></select></div>
                <div class="form-group"><label>M√™s Avalia√ß√£o</label><input type="month" id="av_mes"></div>
            </div>
            <div style="display: flex; flex-wrap: wrap; gap: 20px;">
                <div style="flex: 1; min-width: 300px;">
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px;">
                        <div class="form-group"><label>üèÉ‚Äç‚ôÇÔ∏è F√≠sico</label><input type="number" id="av_fis" min="1" max="10" placeholder="1-10" onchange="atualizarRadarTela()"></div>
                        <div class="form-group"><label>üéØ Finaliza√ß√£o</label><input type="number" id="av_chute" min="1" max="10" placeholder="1-10" onchange="atualizarRadarTela()"></div>
                        <div class="form-group"><label>üëü Passe</label><input type="number" id="av_passe" min="1" max="10" placeholder="1-10" onchange="atualizarRadarTela()"></div>
                        <div class="form-group"><label>üß† T√°tica</label><input type="number" id="av_coord" min="1" max="10" placeholder="1-10" onchange="atualizarRadarTela()"></div>
                        <div class="form-group"><label>ü¶Ö Cabeceio</label><input type="number" id="av_cab" min="1" max="10" placeholder="1-10" onchange="atualizarRadarTela()"></div>
                        <div class="form-group"><label>ü§ù Disciplina</label><input type="number" id="av_disc" min="1" max="10" placeholder="1-10" onchange="atualizarRadarTela()"></div>
                    </div>
                    <button class="btn-add" style="background: #000; color: #fff; width: 100%; margin-bottom: 15px;" onclick="gerarFeedbackIA()"><i class="fa-solid fa-robot"></i> Gerar An√°lise Autom√°tica (IA)</button>
                    <div class="form-group"><label>üìù Parecer do Treinador</label><textarea id="av_obs" rows="3"></textarea></div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                        <button class="btn-add" onclick="salvarAvaliacao()"><i class="fa-solid fa-floppy-disk"></i> Salvar no Hist√≥rico</button>
                        <button class="btn-add" id="btn-pdf" style="background: #007bff; color: white; flex: 1;" onclick="gerarBoletimImagemEZap()"><i class="fa-solid fa-image"></i> Baixar CARD Oficial do Atleta</button>
                    </div>
                </div>
                <div style="flex: 1; min-width: 300px; display: flex; align-items: center; justify-content: center; background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 10px;">
                    <canvas id="radarTela" width="300" height="300"></canvas>
                </div>
            </div>
        </div>

        <div id="agenda" class="tab-content">
            <h2>Calend√°rio de Jogos e Taxas</h2>
            <div class="form-row"><div class="form-group"><label>Data</label><input type="date" id="j_data"></div><div class="form-group" style="flex: 2;"><label>Advers√°rio</label><input type="text" id="j_adv"></div><div class="form-group"><label>Tipo</label><select id="j_tipo"><option>Amistoso</option><option>Campeonato</option></select></div><div class="form-group"><label>Local</label><input type="text" id="j_local"></div><button class="btn-add" onclick="addJogo()">Agendar</button></div>
            <div class="table-responsive"><table><thead><tr><th>Data</th><th>Jogo / Local</th><th>Confirma√ß√µes</th><th>Arrecada√ß√£o</th><th>A√ß√µes</th></tr></thead><tbody id="tb-jogos"></tbody></table></div>
        </div>

        <div id="uniformes" class="tab-content">
            <h2>Venda de Kits (R$ 120,00)</h2>
            <div class="form-row"><div class="form-group" style="flex: 2;"><label>Nome</label><input type="text" id="u_nome"></div><div class="form-group"><label>Tam.</label><select id="u_tam"><option>10</option><option>12</option><option>14</option><option>P</option><option>M</option><option>G</option><option>GG</option></select></div><button class="btn-add" onclick="addUniforme()">Encomendar</button></div>
            <div class="table-responsive"><table><thead><tr><th>Nome</th><th>Tamanho</th><th>Status</th><th>A√ß√µes</th></tr></thead><tbody id="tb-uniformes"></tbody></table></div>
        </div>

        <div id="despesas" class="tab-content">
            <h2>Registro de Despesas</h2>
            <div class="form-row"><div class="form-group" style="flex: 2;"><label>Descri√ß√£o</label><input type="text" id="d_desc"></div><div class="form-group"><label>Cat.</label><select id="d_cat"><option>Professores</option><option>Log√≠stica</option><option>Materiais</option><option>Arbitragem</option><option>Transporte</option><option>Outros</option></select></div><div class="form-group"><label>Valor (R$)</label><input type="number" id="d_valor" step="0.01"></div><button class="btn-add" onclick="addDespesa()">Lan√ßar</button></div>
            <div class="table-responsive"><table><thead><tr><th>Data</th><th>Descri√ß√£o</th><th>Cat.</th><th>Valor</th><th>A√ß√µes</th></tr></thead><tbody id="tb-despesas"></tbody></table></div>
        </div>

        <div id="configuracoes" class="tab-content">
            <h2>Configura√ß√µes do Sistema</h2>
            
            <div class="form-row" style="background: #eef2f5; margin-bottom: 30px;">
                <div class="form-group" style="flex: 2;">
                    <label>Minha Imagem da Equipe (Cole o link do seu escudo oficial)</label>
                    <input type="url" id="cfg_logo" placeholder="Ex: https://...">
                </div>
                <button class="btn-add" onclick="salvarLogo()">Salvar Escudo</button>
            </div>

            <div style="background: #e6f7ff; padding: 20px; border-radius: 8px; border-left: 5px solid #007bff; margin-bottom: 20px;">
                <h3 style="margin-top:0; color:#002244;"><i class="fa-solid fa-cloud-arrow-down"></i> Exportar Dados (Fa√ßa Backup!)</h3>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <button class="btn-add" style="background-color: #217346; color: white;" onclick="exportarExcel()"><i class="fa-solid fa-file-excel"></i> Baixar Planilha Excel (.csv)</button>
                    <button class="btn-add" style="background-color: #007bff; color: white;" onclick="exportarBackup()"><i class="fa-solid fa-download"></i> Salvar Arquivo de Backup (.json)</button>
                </div>
            </div>

            <div style="background: #fff3cd; padding: 20px; border-radius: 8px; border-left: 5px solid #ffc107; margin-bottom: 20px;">
                <h3 style="margin-top:0; color:#856404;"><i class="fa-solid fa-upload"></i> Importar Backup</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                    <input type="file" id="arquivo_import" accept=".json" style="max-width: 250px; background: white; padding: 5px;">
                    <button class="btn-add" style="background: #ff8c00; color: white;" onclick="importarBackup()"><i class="fa-solid fa-cloud-arrow-up"></i> Restaurar Dados</button>
                </div>
            </div>

            <div style="background: #f8d7da; padding: 20px; border-radius: 8px; border-left: 5px solid #dc3545;">
                <button class="btn-add" style="background: #dc3545; color: white;" onclick="resetarMensalidades()"><i class="fa-solid fa-rotate-left"></i> Iniciar Novo M√™s (Zerar Pagamentos)</button>
            </div>
        </div>
    </div> 

    <div id="modalPerfil" class="modal">
        <div class="modal-content" id="modal-box">
            <span class="close-modal" onclick="document.getElementById('modalPerfil').style.display='none'">&times;</span>
            <div class="perfil-header">
                <div class="circulo-pdf circulo-atleta" style="margin:auto; margin-bottom:10px;" id="perf_letra">üë§</div>
                <h2 id="perf_nome" style="margin: 0 0 5px 0; color: var(--azul-escuro);"></h2>
                <span id="perf_cat" class="cat-tag" style="font-size: 14px;"></span>
            </div>
            <div class="perfil-stats"><div>‚öΩ Gols<br><span id="perf_gols" style="font-size: 20px; color: #002244;">0</span></div><div>üü® Amar<br><span id="perf_amar" style="font-size: 20px; color: #ffc107;">0</span></div><div>üü• Verm<br><span id="perf_verm" style="font-size: 20px; color: #dc3545;">0</span></div></div>
            
            <h4 style="margin-bottom: 5px;">Evolu√ß√£o: Atual x 1¬™ Avalia√ß√£o</h4>
            <div class="radar-container"><canvas id="radarModal"></canvas></div>
            <div class="historico-box" id="caixa-historico"></div>
            <button class="btn-add" style="width: 100%; background: #dc3545; color: white; margin-top: 10px;" onclick="document.getElementById('modalPerfil').style.display='none'">Fechar Perfil ‚ùå</button>
        </div>
    </div>

    <div id="relatorio-print-container">
        <div id="relatorio-print">
            <div class="pdf-header">
                <div class="circulo-pdf circulo-clube" id="img_letra_clube">AC</div>
                <img id="img_logo_relatorio" src="" style="width: 70px; height: 70px; object-fit: contain; display:none;">
                
                <div class="pdf-title"><h1>AC NOVA GERA√á√ÉO</h1><h3>Boletim Oficial de Desempenho</h3></div>
                
                <div class="circulo-pdf circulo-atleta" id="img_letra_atleta">üë§</div>
                <img id="img_foto_relatorio" src="" style="width: 70px; height: 70px; border-radius: 50%; object-fit: cover; border: 3px solid #002244; display:none;">
            </div>
            
            <div class="pdf-body">
                <div class="pdf-info">
                    <p><strong>üë§ Atleta:</strong> <span id="img_nome"></span></p>
                    <p><strong>üè∑Ô∏è Categoria:</strong> <span id="img_cat"></span></p>
                    <p><strong>üìÖ Refer√™ncia:</strong> <span id="img_mes"></span></p>
                    <hr>
                    <p><strong>‚öΩ Jogo:</strong> Gols: <span id="img_gols" style="color:#000;font-weight:bold;"></span> | Cart√µes: <span id="img_amar" style="color:#ffc107;font-weight:bold;"></span> üü® / <span id="img_verm" style="color:#dc3545;font-weight:bold;"></span> üü•</p>
                </div>
                <div class="pdf-radar">
                    <canvas id="radarImagem" width="350" height="350"></canvas>
                </div>
            </div>
            
            <div id="img_historico_box" style="margin-top: 15px;"></div>
            <div class="pdf-feedback"><strong>üìù Parecer T√©cnico Oficial:</strong><br><span id="img_obs"></span></div>
            <div style="text-align: center; margin-top: 30px; font-size: 16px; color: #888; font-weight: bold; padding-top: 20px; border-top: 2px solid #eee;">
                Desenvolvido por Adriano "Cabe√ßa" - A Nova Gera√ß√£o √© Nossa!
            </div>
        </div>
    </div>

    <script>
        let db = {
            mensalidades: JSON.parse(localStorage.getItem('sys_mens')) || [], elenco: JSON.parse(localStorage.getItem('sys_elenco')) || [],
            uniformes: JSON.parse(localStorage.getItem('sys_unif')) || [], jogos: JSON.parse(localStorage.getItem('sys_jogos')) || [],
            despesas: JSON.parse(localStorage.getItem('sys_desp')) || []
        };
        db.elenco.forEach(j => { if(!j.notas) j.notas = { coord: '', passe: '', chute: '', cab: '', fis: '', disc: '', obs: '' }; if(!j.historico) j.historico = []; });
        db.jogos.forEach(j => { if(j.confirmados === undefined) j.confirmados = 0; if(j.arrecadado === undefined) j.arrecadado = 0; });

        let sys_logo = localStorage.getItem('sys_logo') || ""; 
        if(sys_logo) { 
            document.getElementById('escudo-topo').src = sys_logo; 
            document.getElementById('escudo-topo').style.display = 'block';
            document.getElementById('topo_letra').style.display = 'none';
            document.getElementById('cfg_logo').value = sys_logo; 
        }

        let chartTela = null; let chartModal = null; let chartImagem = null;

        function salvarDB() {
            localStorage.setItem('sys_mens', JSON.stringify(db.mensalidades)); localStorage.setItem('sys_elenco', JSON.stringify(db.elenco));
            localStorage.setItem('sys_unif', JSON.stringify(db.uniformes)); localStorage.setItem('sys_jogos', JSON.stringify(db.jogos));
            localStorage.setItem('sys_desp', JSON.stringify(db.despesas)); renderizarTudo();
        }

        function formatarMoeda(v) { return `R$ ${parseFloat(v).toFixed(2).replace('.', ',')}`; }
        
        function openTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active')); document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabName).classList.add('active'); event.currentTarget.classList.add('active');
            document.getElementById('main-dash').style.display = (tabName === 'configuracoes' || tabName === 'avaliacao') ? 'none' : 'block';
            if(tabName === 'avaliacao') { atualizarSelectAtletas(); atualizarRadarTela(); }
        }

        window.onclick = function(event) { let modal = document.getElementById('modalPerfil'); if (event.target == modal) { modal.style.display = "none"; } }

        function atualizarAlertasIniciais() {
            let hoje = new Date(); let mesAtual = String(hoje.getMonth() + 1).padStart(2, '0'); let diaAtual = String(hoje.getDate()).padStart(2, '0');
            
            let nivers = db.elenco.filter(j => { if(!j.nasc || j.nasc === '-') return false; return j.nasc.split('/')[1] === mesAtual; });
            nivers.sort((a, b) => parseInt(a.nasc.split('/')[0]) - parseInt(b.nasc.split('/')[0]));
            let listaNiver = document.getElementById('lista-niver'); listaNiver.innerHTML = '';
            if(nivers.length > 0) {
                document.getElementById('box-aniversarios').style.display = 'block';
                nivers.forEach(a => {
                    let isHoje = (a.nasc.split('/')[0] === diaAtual);
                    let msg = encodeURIComponent(`Parab√©ns, ${a.nome}! üéÇ A equipe do AC Nova Gera√ß√£o te deseja um feliz anivers√°rio! ü¶Ö‚öΩ`);
                    listaNiver.innerHTML += `<div class="niver-item ${isHoje?'niver-hoje':''}"><div>${a.nome} (${a.cat}) - ${isHoje?'üéâ √â HOJE!':`Dia ${a.nasc.split('/')[0]}`}</div><a href="https://wa.me/?text=${msg}" target="_blank" class="btn-sm" style="background:${isHoje?'#fff':'#25D366'}; color:${isHoje?'#ff4b82':'#fff'}; text-decoration:none;"><i class="fa-brands fa-whatsapp"></i> Parab√©ns</a></div>`;
                });
            } else { document.getElementById('box-aniversarios').style.display = 'none'; }

            let arts = [...db.elenco].filter(a => a.gols > 0).sort((a, b) => b.gols - a.gols).slice(0, 3);
            let listaArt = document.getElementById('lista-artilheiros'); listaArt.innerHTML = '';
            if(arts.length > 0) {
                let meds = ['ü•á', 'ü•à', 'ü•â'];
                arts.forEach((a, i) => { 
                    let m = db.mensalidades.find(x => x.nome.toLowerCase().includes(a.nome.split(' ')[0].toLowerCase()));
                    let link = m && m.tel ? `https://wa.me/55${m.tel}` : `https://wa.me/`;
                    let txt = encodeURIComponent(`üèÜ Parab√©ns! O atleta ${a.nome} est√° no TOP 3 Artilheiros do AC Nova Gera√ß√£o com ${a.gols} gols! Orgulho do projeto! ü¶Ö‚öΩ`);
                    listaArt.innerHTML += `<div class="niver-item"><div>${meds[i]} <strong>${a.nome}</strong> (${a.cat}) <br><small style="color:#d39e00;">‚öΩ ${a.gols} Gols</small></div><a href="${link}?text=${txt}" target="_blank" class="btn-sm btn-zap" style="text-decoration:none;"><i class="fa-brands fa-whatsapp"></i> Avisar</a></div>`; 
                });
            } else { listaArt.innerHTML = `<div style="font-size:14px; color:#666;">Nenhum gol registrado.</div>`; }
        }

        function addMensalidade() { let n=document.getElementById('m_nome').value; let t=document.getElementById('m_tel').value.replace(/\D/g, ''); let v=document.getElementById('m_venc').value; if(n&&t){db.mensalidades.push({id:Date.now(), nome:n, tel:t, venc:v, pago:false}); document.getElementById('m_nome').value=''; document.getElementById('m_tel').value=''; salvarDB();}else{alert("Preencha nome e Zap!");} }
        function pagarMensalidade(id) { db.mensalidades.find(m => m.id===id).pago=true; salvarDB(); } function delMensalidade(id) { if(confirm('Excluir?')){db.mensalidades=db.mensalidades.filter(m=>m.id!==id); salvarDB();} }
        
        function addJogador() { let n=document.getElementById('e_nome').value; let f=document.getElementById('e_foto').value; let c=document.getElementById('e_cat').value; let dn=document.getElementById('e_nasc').value; if(!n) return; db.elenco.push({ id: Date.now(), nome: n, foto: f, cat: c, nasc: dn?dn.split('-').reverse().join('/'):'-', gols: 0, amarelos: 0, vermelhos: 0, notas: { coord: '', passe: '', chute: '', cab: '', fis: '', disc: '', obs: '' }, historico: [] }); document.getElementById('e_nome').value = ''; document.getElementById('e_foto').value = ''; salvarDB(); }
        function addGol(id) { db.elenco.find(j => j.id===id).gols+=1; salvarDB(); } function addAmarelo(id) { db.elenco.find(j => j.id===id).amarelos+=1; salvarDB(); } function addVermelho(id) { db.elenco.find(j => j.id===id).vermelhos+=1; salvarDB(); } function delJogador(id) { if(confirm('Remover?')) { db.elenco=db.elenco.filter(j=>j.id!==id); salvarDB(); } }
        
        function addJogo() { let d=document.getElementById('j_data').value; let a=document.getElementById('j_adv').value; if(d&&a){db.jogos.push({id:Date.now(), data:d.split('-').reverse().join('/'), adv:a, tipo:document.getElementById('j_tipo').value, local:document.getElementById('j_local').value, confirmados: 0, arrecadado: 0}); document.getElementById('j_adv').value=''; salvarDB();} }
        function addConfirmadoJogo(id) { db.jogos.find(j => j.id===id).confirmados += 1; salvarDB(); } function addTaxaJogo(id) { let v = prompt("Valor da taxa?"); if(v && !isNaN(parseFloat(v.replace(',','.')))) { db.jogos.find(j => j.id===id).arrecadado += parseFloat(v.replace(',','.')); salvarDB(); } } function delJogo(id) { db.jogos=db.jogos.filter(j=>j.id!==id); salvarDB(); }
        
        function addUniforme() { let n=document.getElementById('u_nome').value; if(n){db.uniformes.push({id:Date.now(), nome:n, tam:document.getElementById('u_tam').value, pago:false}); document.getElementById('u_nome').value=''; salvarDB();} }
        function pagarUniforme(id) { db.uniformes.find(u=>u.id===id).pago=true; salvarDB(); } function delUniforme(id) { db.uniformes=db.uniformes.filter(u=>u.id!==id); salvarDB(); }
        
        function addDespesa() { let d=document.getElementById('d_desc').value; let v=document.getElementById('d_valor').value; if(d&&v){db.despesas.push({id:Date.now(), data:new Date().toLocaleDateString('pt-BR'), desc:d, cat:document.getElementById('d_cat').value, valor:v}); document.getElementById('d_desc').value=''; document.getElementById('d_valor').value=''; salvarDB();} }
        function delDespesa(id) { db.despesas=db.despesas.filter(d=>d.id!==id); salvarDB(); }
        
        function salvarLogo() { 
            let n = document.getElementById('cfg_logo').value; 
            localStorage.setItem('sys_logo', n); 
            if(n) { 
                document.getElementById('escudo-topo').src = n; 
                document.getElementById('escudo-topo').style.display = 'block';
                document.getElementById('topo_letra').style.display = 'none';
            } else {
                document.getElementById('escudo-topo').style.display = 'none';
                document.getElementById('topo_letra').style.display = 'flex';
            }
            sys_logo = n; 
            alert('Escudo atualizado no sistema!'); 
        }
        function resetarMensalidades() { if(confirm("Zerar pagamentos do m√™s?")) { db.mensalidades.forEach(m => m.pago = false); salvarDB(); } }

        function renderizarTudo() {
            atualizarAlertasIniciais();
            let tRec = (db.mensalidades.filter(m=>m.pago).length*60) + (db.uniformes.filter(u=>u.pago).length*120); db.jogos.forEach(j => { tRec += (j.arrecadado || 0); });
            let tDesp = db.despesas.reduce((acc, d) => acc + parseFloat(d.valor), 0);
            document.getElementById('dash-receita').innerText = formatarMoeda(tRec); document.getElementById('dash-despesa').innerText = formatarMoeda(tDesp); document.getElementById('dash-saldo').innerText = formatarMoeda(tRec - tDesp);

            let dia = new Date().getDate();
            document.getElementById('tb-mensalidades').innerHTML = db.mensalidades.map(m => {
                let st, txt, btnTexto, btnCor;
                if(m.pago) { 
                    st = `<span class="badge badge-ok">Pago</span>`; 
                    txt = `Ol√°! Agradecemos o pagamento da mensalidade de ${m.nome}. O AC Nova Gera√ß√£o agradece o apoio! ü¶Ö‚öΩ`;
                    btnTexto = `<i class="fa-brands fa-whatsapp"></i> Recibo`; btnCor = `#28a745`;
                } else if(dia > parseInt(m.venc)) { 
                    st = `<span class="badge badge-atrasado">Atrasado</span>`; 
                    txt = `Ol√°, respons√°vel. Consta pend√™ncia na mensalidade de ${m.nome} (vencida dia ${m.venc}). Chave PIX: acnovageracao@outlook.com ü¶Ö`;
                    btnTexto = `<i class="fa-brands fa-whatsapp"></i> Cobrar`; btnCor = `#dc3545`;
                } else { 
                    st = `<span class="badge badge-pendente">A Vencer</span>`; 
                    txt = `Ol√°! Lembrete: a mensalidade de ${m.nome} vence dia ${m.venc}. PIX: acnovageracao@outlook.com ü¶Ö`;
                    btnTexto = `<i class="fa-brands fa-whatsapp"></i> Lembrete`; btnCor = `#ffc107; color:#000`;
                }
                return `<tr><td><strong>${m.nome}</strong><br><small>${m.tel}</small></td><td>Dia ${m.venc}</td><td>${st}</td><td class="action-btns"><a href="https://wa.me/55${m.tel}?text=${encodeURIComponent(txt)}" target="_blank" class="btn-sm" style="background:${btnCor}; text-decoration:none;">${btnTexto}</a> ${!m.pago ? `<button class="btn-sm btn-pay" onclick="pagarMensalidade(${m.id})"><i class="fa-solid fa-check"></i> Baixa</button>` : ''} <button class="btn-sm btn-del" onclick="delMensalidade(${m.id})"><i class="fa-solid fa-trash"></i></button></td></tr>`;
            }).join('');
            
            document.getElementById('tb-elenco').innerHTML = db.elenco.map(j => `<tr><td><strong>${j.nome}</strong><br><small>Nasc: ${j.nasc}</small></td><td><span class="cat-tag">${j.cat}</span></td><td class="action-btns"><button class="btn-sm btn-gol" onclick="addGol(${j.id})">+‚öΩ</button><button class="btn-sm btn-amarelo" onclick="addAmarelo(${j.id})">+üü®</button><button class="btn-sm btn-vermelho" onclick="addVermelho(${j.id})">+üü•</button></td><td><button class="btn-sm btn-perfil" onclick="abrirPerfil(${j.id})">Evolu√ß√£o üîç</button> <button class="btn-sm btn-del" onclick="delJogador(${j.id})">X</button></td></tr>`).join('');
            document.getElementById('tb-jogos').innerHTML = db.jogos.map(j => `<tr><td><strong>${j.data}</strong></td><td>${j.adv}<br><small>${j.tipo} - ${j.local}</small></td><td><span style="font-size:16px; font-weight:bold; color:var(--azul-escuro);">üë• ${j.confirmados||0}</span></td><td><span style="font-size:16px; font-weight:bold; color:green;">${formatarMoeda(j.arrecadado||0)}</span></td><td class="action-btns"><button class="btn-sm btn-azul" onclick="addConfirmadoJogo(${j.id})">+1</button> <button class="btn-sm btn-pay" onclick="addTaxaJogo(${j.id})">+ Taxa</button> <button class="btn-sm btn-del" onclick="delJogo(${j.id})">X</button></td></tr>`).join('');
            document.getElementById('tb-uniformes').innerHTML = db.uniformes.map(u => `<tr><td>${u.nome}</td><td>${u.tam}</td><td>${u.pago?'<span class="badge badge-ok">Pago</span>':'<span class="badge badge-pendente">Pendente</span>'}</td><td class="action-btns">${!u.pago?`<button class="btn-sm btn-pay" onclick="pagarUniforme(${u.id})">Baixa</button>`:''}<button class="btn-sm btn-del" onclick="delUniforme(${u.id})">X</button></td></tr>`).join('');
            document.getElementById('tb-despesas').innerHTML = db.despesas.map(d => `<tr><td>${d.data}</td><td>${d.desc}</td><td>${d.cat}</td><td style="color:red; font-weight:bold;">${formatarMoeda(d.valor)}</td><td class="action-btns"><button class="btn-sm btn-del" onclick="delDespesa(${d.id})">X</button></td></tr>`).join('');
        }

        // ================= AVALIA√á√ÉO E RADAR =================
        function atualizarSelectAtletas() { let s = document.getElementById('av_atleta'); s.innerHTML = '<option value="">-- Escolha --</option>'; db.elenco.forEach(j => { s.innerHTML += `<option value="${j.id}">${j.nome} (${j.cat})</option>`; }); document.getElementById('av_mes').value = `${new Date().getFullYear()}-${String(new Date().getMonth() + 1).padStart(2, '0')}`; }
        function carregarNotas() { let id = parseInt(document.getElementById('av_atleta').value); if(!id) return; let a = db.elenco.find(j => j.id === id); if(a && a.notas) { document.getElementById('av_fis').value = a.notas.fis||0; document.getElementById('av_chute').value = a.notas.chute||0; document.getElementById('av_passe').value = a.notas.passe||0; document.getElementById('av_coord').value = a.notas.coord||0; document.getElementById('av_cab').value = a.notas.cab||0; document.getElementById('av_disc').value = a.notas.disc||0; document.getElementById('av_obs').value = a.notas.obs||''; atualizarRadarTela(); } }
        function salvarAvaliacao() { let id = parseInt(document.getElementById('av_atleta').value); if(!id) return alert("Selecione!"); let a = db.elenco.find(j => j.id === id); let m = document.getElementById('av_mes').value; let nn = { fis: document.getElementById('av_fis').value, chute: document.getElementById('av_chute').value, passe: document.getElementById('av_passe').value, coord: document.getElementById('av_coord').value, cab: document.getElementById('av_cab').value, disc: document.getElementById('av_disc').value, obs: document.getElementById('av_obs').value }; a.notas = nn; if(!a.historico) a.historico = []; let i = a.historico.findIndex(h => h.mes === m); if(i >= 0) { a.historico[i] = { mes: m, notas: nn }; } else { a.historico.push({ mes: m, notas: nn }); } salvarDB(); alert("Salvo no Hist√≥rico!"); atualizarRadarTela(); }
        function gerarFeedbackIA() { let n = { "F√≠sico": +document.getElementById('av_fis').value, "Finaliza√ß√£o": +document.getElementById('av_chute').value, "Passe": +document.getElementById('av_passe').value, "T√°tica": +document.getElementById('av_coord').value, "Cabeceio": +document.getElementById('av_cab').value, "Disciplina": +document.getElementById('av_disc').value }; let max = Object.keys(n).reduce((a, b) => n[a] > n[b] ? a : b); let min = Object.keys(n).reduce((a, b) => n[a] < n[b] ? a : b); let feed = `O atleta tem grande capacidade em ${max}. Nosso foco nos pr√≥ximos treinos ser√° evoluir especificamente a √°rea de ${min}. A Nova Gera√ß√£o √© Nossa!`; if(n[max] === 0 && n[min] === 0) feed = "Preencha as notas primeiro."; document.getElementById('av_obs').value = feed; }

        function criarGraficoRadar(canvasId, notasAtuais, historicoArray, chartInstance) {
            let ctx = document.getElementById(canvasId).getContext('2d'); if(chartInstance) chartInstance.destroy(); 
            let dAtual = { label: 'Atual', data: [notasAtuais.fis||0, notasAtuais.chute||0, notasAtuais.passe||0, notasAtuais.coord||0, notasAtuais.cab||0, notasAtuais.disc||0], backgroundColor: 'rgba(207, 181, 59, 0.5)', borderColor: '#002244', pointBackgroundColor: '#002244', borderWidth: 2 };
            let dFinal = [dAtual];
            if(historicoArray && historicoArray.length > 1) {
                let hOrd = [...historicoArray].sort((a,b) => a.mes.localeCompare(b.mes)); 
                dFinal.push({ label: '1¬™ Aval.', data: [hOrd[0].notas.fis||0, hOrd[0].notas.chute||0, hOrd[0].notas.passe||0, hOrd[0].notas.coord||0, hOrd[0].notas.cab||0, hOrd[0].notas.disc||0], backgroundColor: 'transparent', borderColor: '#888', borderDash: [5, 5], borderWidth: 2 });
            }
            return new Chart(ctx, { type: 'radar', data: { labels: ['F√≠sico', 'Chute', 'Passe', 'T√°tica', 'Cabeceio', 'Disciplina'], datasets: dFinal }, options: { scales: { r: { suggestedMin: 0, suggestedMax: 10, ticks: { stepSize: 2 } } }, plugins: { legend: { position: 'bottom' } }, animation: false } });
        }
        function atualizarRadarTela() { let id = parseInt(document.getElementById('av_atleta').value); let a = db.elenco.find(j => j.id === id); let d = { fis: document.getElementById('av_fis').value, chute: document.getElementById('av_chute').value, passe: document.getElementById('av_passe').value, coord: document.getElementById('av_coord').value, cab: document.getElementById('av_cab').value, disc: document.getElementById('av_disc').value }; chartTela = criarGraficoRadar('radarTela', d, (a ? a.historico : []), chartTela); }

        function gerarTabelaEvolucaoHTML(hArr) {
            if(!hArr || hArr.length === 0) return `<p style="font-size:13px; color:#666; text-align:center;">Nenhuma avalia√ß√£o salva.</p>`;
            let ht = `<table class="historico-table"><tr><th>M√™s</th><th>F√≠s</th><th>Fin</th><th>Pas</th><th>T√°t</th><th>Cab</th><th>Disc</th></tr>`;
            [...hArr].sort((a,b) => b.mes.localeCompare(a.mes)).forEach(h => { ht += `<tr><td>${h.mes.split('-').reverse().join('/')}</td><td>${h.notas.fis||0}</td><td>${h.notas.chute||0}</td><td>${h.notas.passe||0}</td><td>${h.notas.coord||0}</td><td>${h.notas.cab||0}</td><td>${h.notas.disc||0}</td></tr>`; });
            return ht + `</table>`;
        }

        function abrirPerfil(id) {
            let a = db.elenco.find(j => j.id === id);
            document.getElementById('perf_letra').innerText = a.nome.charAt(0).toUpperCase();
            document.getElementById('perf_nome').innerText = a.nome; document.getElementById('perf_cat').innerText = "Cat: " + a.cat; document.getElementById('perf_gols').innerText = a.gols; document.getElementById('perf_amar').innerText = a.amarelos; document.getElementById('perf_verm').innerText = a.vermelhos;
            document.getElementById('caixa-historico').innerHTML = `<h5>üìà Hist√≥rico de Evolu√ß√£o</h5>` + gerarTabelaEvolucaoHTML(a.historico);
            document.getElementById('modalPerfil').style.display = 'flex'; chartModal = criarGraficoRadar('radarModal', a.notas, a.historico, chartModal);
        }

        // ================= GERAR CARD IMAGEM OFICIAL (COM FOTO/ESCUDO REAIS) =================
        function gerarBoletimImagemEZap() {
            let id = parseInt(document.getElementById('av_atleta').value); if(!id) return alert("Selecione um atleta!");
            let btn = document.getElementById('btn-pdf'); btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Gerando Foto...';
            
            let a = db.elenco.find(j => j.id === id); let mIn = document.getElementById('av_mes').value;
            
            // Lida com o Escudo no Card
            if(sys_logo) {
                document.getElementById('img_logo_relatorio').src = sys_logo;
                document.getElementById('img_logo_relatorio').style.display = 'block';
                document.getElementById('img_letra_clube').style.display = 'none';
            } else {
                document.getElementById('img_logo_relatorio').style.display = 'none';
                document.getElementById('img_letra_clube').style.display = 'flex';
            }

            // Lida com a Foto do Atleta no Card
            if(a.foto && a.foto !== '') {
                document.getElementById('img_foto_relatorio').src = a.foto;
                document.getElementById('img_foto_relatorio').style.display = 'block';
                document.getElementById('img_letra_atleta').style.display = 'none';
            } else {
                document.getElementById('img_foto_relatorio').style.display = 'none';
                document.getElementById('img_letra_atleta').style.display = 'flex';
                document.getElementById('img_letra_atleta').innerText = a.nome.charAt(0).toUpperCase();
            }

            document.getElementById('img_nome').innerText = a.nome; document.getElementById('img_cat').innerText = a.cat; document.getElementById('img_mes').innerText = mIn.split('-').reverse().join('/'); document.getElementById('img_gols').innerText = a.gols; document.getElementById('img_amar').innerText = a.amarelos; document.getElementById('img_verm').innerText = a.vermelhos; document.getElementById('img_obs').innerText = document.getElementById('av_obs').value || '-';
            document.getElementById('img_historico_box').innerHTML = `<h4 style="margin-bottom:5px; color:#002244;">üìà Hist√≥rico de Avalia√ß√µes</h4>` + gerarTabelaEvolucaoHTML(a.historico);

            chartImagem = criarGraficoRadar('radarImagem', a.notas, a.historico, chartImagem);
            
            let container = document.getElementById('relatorio-print-container');
            container.style.display = 'block';

            setTimeout(() => {
                html2canvas(document.getElementById('relatorio-print'), { scale: 2, useCORS: true }).then(canvas => {
                    container.style.display = 'none';
                    let link = document.createElement('a'); link.download = `Card_Boletim_${a.nome.replace(/\s/g, '_')}.png`; link.href = canvas.toDataURL("image/png"); link.click();
                    btn.innerHTML = '<i class="fa-solid fa-image"></i> Baixar CARD Oficial do Atleta'; 
                    
                    let msg = `Ol√°! ü¶Ö \n\nAcabei de gerar o *Boletim Oficial de Desempenho (Card)* do atleta ${a.nome}.\n\n_(A imagem j√° foi salva na galeria do seu celular. Por favor, anexe a foto clicando no √≠cone do clipe üìé ou c√¢mera üì∑ aqui na nossa conversa!)_\n\nA Nova Gera√ß√£o √© Nossa!`;
                    let mens = db.mensalidades.find(x => x.nome.toLowerCase().includes(a.nome.split(' ')[0].toLowerCase()));
                    if(mens && mens.tel) { window.open(`https://wa.me/55${mens.tel}?text=${encodeURIComponent(msg)}`, '_blank'); } 
                    else { window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank'); }
                }).catch(err => {
                    container.style.display = 'none'; btn.innerHTML = '<i class="fa-solid fa-image"></i> Baixar CARD Oficial do Atleta'; alert("A foto externa usada no cadastro bloqueou a imagem por seguran√ßa de internet. Tente remover a foto do atleta.");
                });
            }, 500); 
        }

        // ================= EXPORTAR / IMPORTAR =================
        function exportarExcel() { let c = "data:text/csv;charset=utf-8,\uFEFF=== MENSALIDADES ===\nNome;WhatsApp;Vencimento;Status\n"; db.mensalidades.forEach(m => { c += `${m.nome};${m.tel};Dia ${m.venc};${m.pago ? "Pago" : "Pendente"}\n`; }); c += "\n=== ELENCO (JOGADORES) ===\nJogador;Categoria;Data Nasc;Gols;Amarelos;Vermelhos\n"; db.elenco.forEach(e => { c += `${e.nome};${e.cat};${e.nasc};${e.gols};${e.amarelos || 0};${e.vermelhos || 0}\n`; }); let l = document.createElement("a"); l.setAttribute("href", encodeURI(c)); l.setAttribute("download", "Relatorio_AC.csv"); document.body.appendChild(l); l.click(); l.remove(); }
        function exportarBackup() { let b={bancoDados:db, logoEquipe:sys_logo}; let l=document.createElement('a'); l.href='data:application/json;charset=utf-8,'+encodeURIComponent(JSON.stringify(b)); l.download='backup_ac.json'; document.body.appendChild(l); l.click(); l.remove(); }
        function importarBackup() { let f=document.getElementById('arquivo_import').files[0]; if(!f)return; let r=new FileReader(); r.onload=function(e){try{let b=JSON.parse(e.target.result); if(b.bancoDados){ localStorage.setItem('sys_mens',JSON.stringify(b.bancoDados.mensalidades||[])); localStorage.setItem('sys_elenco',JSON.stringify(b.bancoDados.elenco||[])); localStorage.setItem('sys_unif',JSON.stringify(b.bancoDados.uniformes||[])); localStorage.setItem('sys_jogos',JSON.stringify(b.bancoDados.jogos||[])); localStorage.setItem('sys_desp',JSON.stringify(b.bancoDados.despesas||[])); if(b.logoEquipe)localStorage.setItem('sys_logo',b.logoEquipe); alert("Sucesso! Os dados foram restaurados."); location.reload(); }}catch(err){alert("Erro ao ler o arquivo de backup.");}}; r.readAsText(f); }

        renderizarTudo();
    </script>
</body>
</html>